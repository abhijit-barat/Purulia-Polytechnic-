<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>College Attendance System</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
            transition: background 0.3s, color 0.3s;
        }

        :root {
            --bg-color: #f8f9fa;
            --text-color: #2c3e50;
            --primary-color: #28a745;
            --secondary-color: #218838;
            --input-bg: #ffffff;
            --input-border: #dee2e6;
            --table-bg: #ffffff;
            --table-border: #dee2e6;
        }

        .dark-mode {
            --bg-color: #1a1a1a;
            --text-color: #f8f9fa;
            --input-bg: #2c3e50;
            --input-border: #495057;
            --table-bg: #2c3e50;
            --table-border: #495057;
        }

        .container {
            background: var(--input-bg);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 1000px;
            margin: 0 auto;
        }

        h2 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
            text-align: center;
        }

        .input-group {
            display: grid;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        input, select, button {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid var(--input-border);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: var(--input-bg);
            color: var(--text-color);
        }

        input:focus, select:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        button {
            background: var(--primary-color);
            color: white;
            cursor: pointer;
        }

        button:hover {
            background: var(--secondary-color);
            transform: translateY(-1px);
        }

        table {
            width: 100%;
            margin-top: 2rem;
            border-collapse: collapse;
            background: var(--table-bg);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        th, td {
            padding: 1rem;
            text-align: center;
            border-bottom: 1px solid var(--table-border);
        }

        th {
            background: var(--primary-color);
            color: white;
            font-weight: 600;
        }

        tr:nth-child(even) {
            background-color: var(--bg-color);
        }

        #status {
            margin-top: 1rem;
            text-align: center;
            font-weight: 500;
            padding: 0.8rem;
            border-radius: 8px;
        }

        .toggle-buttons {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .toggle-buttons button {
            width: auto;
            padding: 0.5rem 1rem;
        }

        .chart-container {
            margin-top: 2rem;
        }

        @media (max-width: 480px) {
            .container {
                padding: 1.5rem;
            }

            button {
                font-size: 1rem;
                padding: 0.9rem;
            }

            th, td {
                padding: 0.8rem;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="toggle-buttons">
            <button onclick="toggleLanguage()">বাংলা/English</button>
            <button onclick="toggleDarkMode()">Toggle Dark Mode</button>
        </div>
        <h2 id="title">Purulia Polytechnic Attendance</h2>
        <div class="input-group">
            <input type="text" id="name" placeholder="Full Name" required>
            <input type="text" id="roll" placeholder="Roll Number" required>
            <select id="trade">
                <option value="ME">Mechanical Engineering</option>
                <option value="CE">Civil Engineering</option>
                <option value="EE">Electrical Engineering</option>
                <option value="MET">Metallurgy</option>
                <option value="ETC">Electronics & Telecommunication</option>
            </select>
            <select id="year">
                <option value="1st Year">1st Year</option>
                <option value="2nd Year">2nd Year</option>
                <option value="3rd Year">3rd Year</option>
            </select>
        </div>
        <button onclick="markAttendance()">Mark Attendance</button>
        <p id="status"></p>
        <p id="locationInfo"></p>

        <h3 id="attendanceTitle">Attendance Records</h3>
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Roll</th>
                    <th>Trade</th>
                    <th>Year</th>
                    <th>Status</th>
                    <th>Time</th>
                </tr>
            </thead>
            <tbody id="attendanceTable"></tbody>
        </table>

        <h3>Attendance Percentage</h3>
        <input type="text" id="studentRoll" placeholder="Enter Roll Number">
        <button onclick="calculatePercentage()">Calculate Percentage</button>
        <p id="percentageResult"></p>
    </div>

    <script>
        // Configuration
        const collegeLocation = {
            lat: 23.333,
            lon: 86.366,
            radius: 0.2 // in kilometers
        };

        const translations = {
            en: {
                title: "Purulia Polytechnic Attendance",
                namePlaceholder: "Full Name",
                rollPlaceholder: "Roll Number",
                markAttendance: "Mark Attendance",
                attendanceTitle: "Attendance Records",
                searchPlaceholder: "Search by name or roll",
                calculatePercentage: "Calculate Percentage",
                percentagePlaceholder: "Enter Roll Number"
            },
            bn: {
                title: "পুরুলিয়া পলিটেকনিক উপস্থিতি",
                namePlaceholder: "পুরো নাম",
                rollPlaceholder: "রোল নম্বর",
                markAttendance: "উপস্থিতি মার্ক করুন",
                attendanceTitle: "উপস্থিতির রেকর্ড",
                searchPlaceholder: "নাম বা রোল দ্বারা অনুসন্ধান করুন",
                calculatePercentage: "শতাংশ গণনা করুন",
                percentagePlaceholder: "রোল নম্বর লিখুন"
            }
        };

        let currentLanguage = 'en';

        // Utility functions
        const getDistance = (lat1, lon1, lat2, lon2) => {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            return R * (2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)));
        };

        const showStatus = (message, isError = false) => {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.style.color = isError ? '#dc3545' : '#28a745';
            statusEl.style.backgroundColor = isError ? '#f8d7da' : '#d4edda';
        };

        const updateLocationInfo = (distance) => {
            const locationInfo = document.getElementById('locationInfo');
            locationInfo.textContent = `Distance from college: ${distance.toFixed(2)} km`;
        };

        // Core functionality
        const markAttendance = async () => {
            const inputs = {
                name: document.getElementById('name').value.trim(),
                roll: document.getElementById('roll').value.trim(),
                trade: document.getElementById('trade').value,
                year: document.getElementById('year').value
            };

            if (Object.values(inputs).some(value => !value)) {
                showStatus('Please fill all required fields!', true);
                return;
            }

            try {
                const position = await new Promise((resolve, reject) => {
                    navigator.geolocation.getCurrentPosition(resolve, reject);
                });

                const userCoords = position.coords;
                const distance = getDistance(
                    userCoords.latitude,
                    userCoords.longitude,
                    collegeLocation.lat,
                    collegeLocation.lon
                );

                updateLocationInfo(distance);

                if (distance > collegeLocation.radius) {
                    showStatus('Attendance restricted to college premises', true);
                    return;
                }

                const record = {
                    ...inputs,
                    status: 'Present',
                    timestamp: new Date().toLocaleString()
                };

                const attendance = JSON.parse(localStorage.getItem('attendance') || '[]');
                attendance.push(record);
                localStorage.setItem('attendance', JSON.stringify(attendance));
                
                updateTable();
                showStatus('Attendance recorded successfully!');
                document.getElementById('name').value = '';
                document.getElementById('roll').value = '';
            } catch (error) {
                showStatus(error.message.includes('denied') 
                    ? 'Please enable location services' 
                    : 'Geolocation error', true);
            }
        };

        const updateTable = () => {
            const attendance = JSON.parse(localStorage.getItem('attendance') || '[]');
            const tbody = document.getElementById('attendanceTable');
            
            tbody.innerHTML = attendance.map(record => `
                <tr>
                    <td>${record.name}</td>
                    <td>${record.roll}</td>
                    <td>${record.trade}</td>
                    <td>${record.year}</td>
                    <td style="color: ${record.status === 'Present' ? '#28a745' : '#dc3545'}">
                        ${record.status}
                    </td>
                    <td>${record.timestamp}</td>
                </tr>
            `).join('');
        };

        const calculatePercentage = () => {
            const roll = document.getElementById('studentRoll').value.trim();
            const attendance = JSON.parse(localStorage.getItem('attendance') || '[]');
            const studentRecords = attendance.filter(record => record.roll === roll);
            const totalRecords = studentRecords.length;
            const presentRecords = studentRecords.filter(record => record.status === 'Present').length;
            const percentage = (presentRecords / totalRecords) * 100 || 0;

            document.getElementById('percentageResult').textContent = `Attendance Percentage: ${percentage.toFixed(2)}%`;
        };

        const toggleLanguage = () => {
            currentLanguage = currentLanguage === 'en' ? 'bn' : 'en';
            document.getElementById('title').textContent = translations[currentLanguage].title;
            document.getElementById('name').placeholder = translations[currentLanguage].namePlaceholder;
            document.getElementById('roll').placeholder = translations[currentLanguage].rollPlaceholder;
            document.getElementById('search').placeholder = translations[currentLanguage].searchPlaceholder;
            document.getElementById('studentRoll').placeholder = translations[currentLanguage].percentagePlaceholder;
            document.querySelector('button[onclick="markAttendance()"]').textContent = translations[currentLanguage].markAttendance;
            document.querySelector('button[onclick="calculatePercentage()"]').textContent = translations[currentLanguage].calculatePercentage;
        };

        const toggleDarkMode = () => {
            document.body.classList.toggle('dark-mode');
        };

        // Initial setup
        window.addEventListener('DOMContentLoaded', () => {
            updateTable();
            document.getElementById('name').focus();
        });
    </script>
</body>
</html>
